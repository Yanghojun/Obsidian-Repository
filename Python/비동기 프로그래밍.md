# async, await

- ì•Œì•„ì•¼ í•  ê²ƒ
	- `async`ê°€ ë¶™ì€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´, í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ”ê²Œ ì•„ë‹ˆë¼, ì½”ë£¨í‹´(coroutine) ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.
	- `await` í‚¤ì›Œë“œë¥¼ ë¶™ì—¬ì•¼ ì½”ë£¨í‹´ ê°ì²´ê°€ ì‹¤í–‰ëœë‹¤.
```python
async def do_async():
	return 'async'

do_async() # í˜¸ì¶œ ì‹œ coroutine ê°ì²´ê°€ ë°˜í™˜ëŒ.

## ì¶œë ¥ì˜ˆì‹œ
<coroutine object do_async at 0x7f2c0c1f44a0>
```

- `await` í‚¤ì›Œë“œëŠ” I/O ì‘ì—…ì´ ìˆì„ ë•Œ íš¨ê³¼ê°€ ìˆë‹¤.
	- I/O ì‘ì—…ì´ë€ CPUê°€ ì™¸ë¶€ ë¬¼ë¦¬ì¥ì¹˜ì™€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ê³¼ì •ì„ ë§í•œë‹¤.
		- Disk read, write
		- Network í†µì‹  ë“±

```python
import asyncio

async def task1():
    print("task1 ì‹œì‘")
    await 1 + 2  # ë‹¨ìˆœ ê³„ì‚° (I/O ì‘ì—… X)
    print("task1 ë")

async def task2():
    print("task2 ì‹œì‘")
    await asyncio.sleep(1)  # I/O ì‘ì—… (ë¹„ë™ê¸°ì ìœ¼ë¡œ ëŒ€ê¸°)
    print("task2 ë")

async def main():
    await asyncio.gather(task1(), task2())

asyncio.run(main())

## ì¶œë ¥ê²°ê³¼
task1 ì‹œì‘
task1 ë
task2 ì‹œì‘
task2 ë
```

- awaitë¡œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œì— **I/O ì‘ì—…ì´ ìˆì„ ë•Œ** CPUê°€ ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë„ë¡ **ëŒ€ê¸° ìƒíƒœ**ê°€ ë˜ê³ , ì´ë²¤íŠ¸ ë£¨í”„ì˜ ë‹¤ë¥¸ ì½”ë£¨í‹´ì„ ì‹¤í–‰í•œë‹¤.

```python
import asyncio

# ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜
async def first_job_download_data():
    print("ğŸ“¥ first_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œì‘")
    await asyncio.sleep(2)  # 2ì´ˆ ëŒ€ê¸° (ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜)
    print("âœ… first_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!")

async def second_job_download_data():
    print("ğŸ“¥ second_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œì‘")
    await asyncio.sleep(2)  # 2ì´ˆ ëŒ€ê¸° (ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜)
    print("âœ… second_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!")

# ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ (ë‹¤ë¥¸ ë¹„ë™ê¸° í•¨ìˆ˜ í˜¸ì¶œ)
async def process_data():
    print("ğŸ› ï¸ ë°ì´í„° ì²˜ë¦¬ ì‹œì‘")
    await first_job_download_data()  # download_data()ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œ
    print("âœ… ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ!")

# ë©”ì¸ í•¨ìˆ˜
async def main():
    # ì—¬ëŸ¬ ë¹„ë™ê¸° ì‘ì—…ì„ ë™ì‹œì— ì‹¤í–‰
    await asyncio.gather(
        process_data(),  # ë°ì´í„° ì²˜ë¦¬ ì‹œì‘
        # print("ğŸŒ ë©”ì¸ ì‘ì—… ì‹¤í–‰ ì¤‘...")  # ë‹¤ë¥¸ ì‘ì—…ë„ ë™ì‹œì— ì‹¤í–‰
        second_job_download_data(),
    )

# ë¹„ë™ê¸° í”„ë¡œê·¸ë¨ ì‹¤í–‰
asyncio.run(main())


## ì¶œë ¥ê²°ê³¼
ğŸ› ï¸ ë°ì´í„° ì²˜ë¦¬ ì‹œì‘
ğŸ“¥ first_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œì‘
ğŸ“¥ second_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì‹œì‘
âœ… first_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!
âœ… ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ!
âœ… second_job ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!
```

Multi - Threading ê°œë…ê³¼ëŠ” ë‹¤ë¥´ë‹¤.
- Single Threadë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ì½”ë£¨í‹´ ê°ì²´ê°€ awaitë¥¼ ë§Œë‚  ê²½ìš°, **ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¸°íšŒë¥¼ ì£¼ê³ **, ê·¸ ì‘ì—…ì´ ëë‚˜ë©´ ì›ë˜ ì‘ì—…ì„ ë‹¤ì‹œ ì²˜ë¦¬í•˜ëŠ”ê²ƒì´ë‹¤.

# async for
- iterratorê°€ ë¹„ë™ê¸°ì—¬ì•¼ í•œë‹¤.
	- ë‚´ë¶€ì ìœ¼ë¡œ `await`ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë°›ìŒ

```python
resp = agent.workflow.astream_events(state, scheme.config, version="v2")
	async for event in resp:
```